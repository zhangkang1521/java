
<div class="container">
    <div class="list-group">
        <p id="login_bg"><img src="/images/login_bg.png" width="100%"/> </p>
        <form  id="confirm" method="post">
        <div id="login_info">
            <div id="login_opacity"></div>
            <ul class="list-unstyled" id="login_ul">
                <li class="clearfix"><input type="text" class="login_input1" placeholder="请输入手机号" style="color: #fff;" id="userPhone" name="userPhone"></li>
                <li class="clearfix"><input type="password" class="login_input2" placeholder="输入密码" style="color: #fff;" id="userPwd" name="userPwd"></li>
                <li class="clearfix"><input type="password" class="login_input2" placeholder="确认的密码" style="color: #fff;" id="userPwd2" name="passWord2"></li>
                <li class="clearfix"><input type="text" class="login_input3 pull-left" placeholder="请输入验证码" style="color: #fff;" name="Verification"  id="Verification"><a href="javascript:;" onclick="sendMsg();" class="pull-left" id="yanzhengma">获取验证码</a> </li>
            </ul>
            <p class="bd_save mt25px"><a href="javascript:;" onclick="confirm();">确认修改</a></p>
            <p id="login_que" class="clearfix">
            </p>
        </div>
        </form>
    </div>
</div>
<!-- 内容区 end -->
<script type="text/javascript">

//登录密码校验
	function userPwdCheck(){
		var userPwd=$.trim($('#userPwd').val());
		var userPwd2=$.trim($('#userPwd2').val());
		if(userPwd==null || userPwd==""){
			$('#userPwd').focus();
			layer.alert('密码不能为空！');
			return false;
		} else if(userPwd.length < 6 || userPwd.length > 16) {
			$('#userPwd').focus();
			layer.alert('密码长度为6-16位');
			return false;
		} 
		
		if(userPwd2==null || userPwd2==""){
			$('#userPwd2').focus();
			layer.alert('确认密码不能为空');
			return false;
		}else if(userPwd != userPwd2){
			$('#userPwd2').focus();
			layer.alert('两次输入密码不一致');
			return false;
		}
		return true;
	}
//手机号
function userPhoneCheck(){
	var userPhone=$.trim($('#userPhone').val());
	if(userPhone==null || userPhone==""){
		layer.alert('手机号不能为空！');
		return false;
	}
	var reg = /^1\d{10}$/
	if(!reg.test(userPhone)){
		layer.alert('手机号格式不正确！');
		return false;
	}
	return true;
}
//验证码
function VerificationCheck(){
	var Verification=$.trim($('#Verification').val());
	if(Verification==null || Verification==""){
		layer.alert('验证码不能为空！');
		return false;
	}
	return true;
}
//校验
function check(){
	return (userPhoneCheck() 
			&&userPwdCheck()
			&& VerificationCheck());
}
//确认修改
function confirm(){	
	if(!check()){
		return false;
	}
	$.ajax({
          type: "POST",
          url:"/login/json/wangjimima.json",
          data: $('#confirm').serialize(),
          success: function (data) {
			if(data.success){
			layer.alert(data.message);
			window.location.href="/login/login";
            }else {                   	
            layer.alert(data.message);
			window.location.href="wangjimima";
               }
           },

    });
 }


//发送短息
function sendMsg(){
    var mobile=/^1[3458]\d{9}$/;
    var phone=$.trim($("#userPhone").val());
    var username=$.trim($("#userPhone").val());
    if(userPhoneCheck()){
    	 $("#yanzhengma").removeAttr("onclick");
    	  $.ajax({
              url:'/register/json/sendPhoneCode.json',
                  type:'post',
                  async:false,
                  data:{"telephone":phone,"username":username},
                  success: function(data){
                      if(data.success){
                    	 $("#yanzhengma").removeAttr("onclick");
                    	 $("#yanzhengma").removeClass("c-btn").addClass("c-btn-hui");
                      	 $("#yanzhengma").html(60);                      	 
                      	 timedCount(60);
                      }else {                   	
                      	layer.alert(data.message); 
                      	$("#yanzhengma").attr("onclick","sendMsg();");
                      }
                  },
                  error : function(){                	 
                      layer.alert("短信发送失败！");
                      $("#yanzhengma").attr("onclick","sendMsg();");
                  }
          });
    }      
}
//定时器
function timedCount(num){
    if(num==0){
    	$("#yanzhengma").attr("onclick","sendMsg();");
    	 $("#yanzhengma").removeClass("c-btn-hui").addClass("c-btn");
        $("#yanzhengma").html("获取验证码");
        return;
    }
    num = num - 1;
    $("#yanzhengma").html(num);
    setTimeout("timedCount("+num+")",1000); 
}
</script>