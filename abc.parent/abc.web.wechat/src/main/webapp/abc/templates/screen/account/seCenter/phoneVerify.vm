 
<!--首页头部-->
<nav id="nav" class="nav">
    <a class="navbar-brand nabar_color"  href="/account/myAccount/accountOverview"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span></a>
    <div class="clearfix index_suo text-center"><span>手机认证</span> </div>
</nav>
<!--首页头部 end-->

<div class="container" style="overflow-x:hidden">
<div class="row mt10">
    <div  class="col-sm-12 col-xs-12">
    <input id="username" type="hidden" value="$!user.userName" />
		<form id="form1">
		 <ul class="list-unstyled c-us-list">
        	<li class="c-line"><label>手机验证：</label><input type="text" id="userPhone" name="userPhone"  placeholder="请输入您的手机号码" style="font-size:16px"/></li>
			<li class="c-line"><label>验证码：</label><input type="text" id="Verification" name="Verification"  placeholder="请输入验证码" style="font-size:16px; width:40%;"/><a href="javascript:;" id="getVerifyCode"  class="btn c-yzm-btn">获取验证码</a></li>
         </ul>
		</form>
          <p class="bd_save container mt25px"><a href="javascript:;" onclick="save()">保存</a></p>	
    </div>
</div>
</div>
<!-- 内容区 end -->
<script>
$(document).ready(function(){
	//发送验证码绑定事件
	$("#getVerifyCode").bind("click", sendPhoneCode);
	
	//表单验证
	$("#form1").validate({
		rules: {
			userPhone: {
				required: true,
				mobile: true,
				//remote: '/Verification/json/Verification.json?flag=2'
			},
			Verification: {
				required: true
			}
		},
		messages: {
			
		},
		onkeyup: false 
	});
});

//验证码定时器
function timedCount(num){
    if(num==0){
    	$("#getVerifyCode").bind("click", sendPhoneCode);
    	$("#getVerifyCode").css("cursor","pointer");
    	$("#getVerifyCode").html("获取验证码");
        return;
    }
    num = num - 1;
    $("#getVerifyCode").html(num + "秒");
    setTimeout("timedCount("+num+")",1000);
}

//发送验证码
function sendPhoneCode(){
	if(!$("#userPhone").valid()){
		return;
	}
	$.ajax({
		url: "/register/json/SendPhoneCode.json",
		data: {
			"userPhone": $("#userPhone").val(),
			"username": $("#username").val()
		},
		success: function(result){
			if(result.success){
				$("#getVerifyCode").css("cursor","default");
				$("#getVerifyCode").unbind("click");//取消时间，1分钟内不能再发验证码
			  	$("#getVerifyCode").html(60 + "秒");
			    timedCount(60);
			}
		}
	});
}

//校验
function check(){
	return (userPhoneCheck() && VerificationCheck());
}


//保存到数据库中
function save(){
	if(!check()){
		return false;
	}
	if(!$("#form1").valid()){
		return;
	}
	$.ajax({
    	 url:'/account/myAccount/json/basicInformationEdit.json',
         type:'post',
         data:$("#form1").serialize(),
         success: function(data){
             if(data.success){
            	 window.location='/account/seCenter/success?title=手机验证';
             }else {
            	 layer.alert(data.message);
             }
         }
 	});
}

//手机号
function userPhoneCheck(){
	var userPhone=$.trim($('#userPhone').val());
	if(userPhone==null || userPhone==""){
		layer.alert('手机号不能为空！');
		return false;
	}
	var reg = /^1\d{10}$/
	if(!reg.test(userPhone)){
		layer.alert('手机号格式不正确！');
		return false;
	}else{
		var returnResult=false;
		 $.ajax({
            url:'/Verification/json/Verification.json',
                type:'post',
                async:false,
                data:{"userPhone":userPhone,"flag":"2"},
                success: function(data){
                    if(data.success){
                   	 returnResult=true;          
                    }else {
                   	 layer.alert(data.message);
                    }
                },
                error : function(){
                    alert("通信异常！");
                }
        });
		 return returnResult;
	}
	return true;
}
//验证码
function VerificationCheck(){
	var Verification=$.trim($('#Verification').val());
	if(Verification==null || Verification==""){
		layer.alert('验证码不能为空！');
		return false;
	}
	return true;
}
</script>


 
