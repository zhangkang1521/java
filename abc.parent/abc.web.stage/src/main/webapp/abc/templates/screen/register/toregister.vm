<!--hearder-top-->
$control.setTemplate("common/head.vm")
<!--header-nav end-->
<!--content-->
<div class="c-zc c-rad5">
	<ul class="clearfloat">
    	<li style="width:12px;" class="fl xian mt10"></li>
        <li class="fl z16 ml5">账户注册</li>
        <li style="width:604px;" class="fl xian mt10 ml5"></li>
        <li class="fl ml5">我有账号？<a href="/login/login" class="c-blue">立即登录</a></li>
        <li style="width:60px;" class="fl xian mt10 ml5"></li>
    </ul>
    
    <ul class="clearfloat mt30">
    	<li class="fl">
            <form class="c-dl-box" action="/register/register" method="post" id="register">
                <ul>
                	<li class="c-red ml20">温馨提示：*号为必填选项</li>
                    
                    <li class="clearfloat">
                        <div class="fl c-zc-text">用户名</div>
                        <div class="fl ml15">
                            <input class="c-dl-input1" type="text" name="userName" id="userName" value="$!userx.userName" placeholder="请输入用户名"  onblur="userNameCheck()"/>
                            <div class="Validform_checktip" id="userNameMsg"></div>
                        </div>
                        <div class="fl c-red c-zc-xing">*</div>
                    </li>
                    
                    <li class="clearfloat" >
                        <div class="fl c-zc-text">邮箱</div>
                        <div class="fl ml15">
                            <input class="c-dl-input1" type="text" name="userEmail"  id="userEmail" value="$!userx.userEmail" placeholder="请输入邮箱"  onblur="userEmailCheck()"/>
                            <div class="Validform_checktip" id="userEmailMsg"></div>
                        </div>
                        <div class="fl c-red c-zc-xing">*</div>
                    </li>
                    
                    <li class="clearfloat">
                        <div class="fl c-zc-text">密码</div>
                        <div class="fl ml15">
                            <input class="c-dl-input1" type="password" name="userPwd" id="userPwd" value="$!userx.userPwd" placeholder="请输入密码" onblur="userPwdCheck()" />
                            <div class="Validform_checktip" id="userPwdMsg"></div>
                        </div>
                        <div class="fl c-red c-zc-xing">*</div>
                    </li>
                    
                    <li class="clearfloat">
                        <div class="fl c-zc-text">确认密码</div>
                        <div class="fl ml15">
                            <input class="c-dl-input1" type="password" name="repuserPwd" id="repuserPwd" placeholder="请输入确认密码" onblur="repuserPwdCheck()" />
                            <div class="Validform_checktip" id="repuserPwdMsg"></div>
                        </div>
                        <div class="fl c-red c-zc-xing">*</div>
                    </li>
                    
                    <li class="clearfloat" >
                        <div class="fl c-zc-text">手机号</div>
                        <div class="fl ml15">
                            <input class="c-dl-input1" type="text" name="userPhone" id="userPhone"  value="$!userx.userPhone" placeholder="请输入手机号" onblur="userPhoneCheck();" />
                            <div class="Validform_checktip" id="userPhoneMsg"></div>
                        </div>
                        <div class="fl c-red c-zc-xing">*</div>
                    </li>
                    
                    #if($!{InvitationId})
	            	<li class="clearfloat">
                        <div class="fl c-zc-text">服务码</div>
                        <div class="fl ml15">
                            <input class="c-dl-input2" type="password" name="InvitationId" value="$!{InvitationId}" placeholder="" readonly="readonly"/>
                            <div class="Validform_checktip" id="userRecommendUseridMsg"></div>
                        </div>
                    </li>
		            #else
		            <li class="clearfloat">
                        <div class="fl c-zc-text">服务码</div>
                        <div class="fl ml15">
                            <input class="c-dl-input2" id="InvitationPhone" name="InvitationPhone" value="$!{InvitationPhone}" placeholder="请输入服务编码" onblur="InvitationPhoneCheck();" />
                            <div class="Validform_checktip" id="InvitationPhoneMsg"></div>
                        </div>
                    </li>
		            #end
                    
                    <li class="clearfloat" >
                        <div class="fl c-zc-text">验证码</div>
                        <div class="fl ml15">
                            <input class="c-dl-input2" type="text" name="Verification"  id="Verification" placeholder="请输入验证码"  onblur="VerificationCheck()" />
                            <div class="Validform_checktip" id="VerificationMsg">$!securityError</div>
                        </div>
                        <div class="fl ml10">
                        <a class="c-btn c-zc-hqma" href="javascript:;" onclick="sendMsg();" id="yanzhengma">获取验证码</a>                      
                        </div>
                        <div class="fl c-red c-zc-xing">*</div>
                    </li>
                    
                    <li class="clearfloat z12">
                        <label>
                                <span class="fl ml75 mr5"><input type="checkbox" id="agreement" /></span>
                                <span class="fl">我已阅读并同意新华久久贷<a class="c-blue" href="/protocol/protocol" target="_blank">《注册协议》</a></span>
                      			
                        </label>
                    </li>
                    
                    <li>
                    <a class="c-btn c-zc-btn" href="javascript:;" onclick="register();">立即注册</a>
                    </li>
                </ul>
            </form>
        </li>
        <li class="fr mt50"><img src="/Images/c-zc-ad.jpg" /></li>
    </ul>
</div>
<!--content end-->

<!--footer-->
$control.setTemplate("common/foot.vm")
<!--footer end-->
<script type="text/javascript">
//用户名
function userNameCheck(){
	var userName=$.trim($('#userName').val());
	var userNameReg = /^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{6,20}$/;//6-20位数字和字母的组合
	if(!userNameReg.test(userName)){
		$('#userNameMsg').html('用户名为6-20位数字和字母的组合');
		return false;
	}else{
		var returnResult=false;
		 $.ajax({
             url:'/Verification/json/Verification.json',
                 type:'post',
                 async:false,
                 data:{"userName":userName,"flag":"1"},
                 success: function(data){
                     if(data.success){
                    	 returnResult=true;          
                     }else {
                    	 $('#userNameMsg').html(data.message);
                     }
                 },
                 error : function(){
                     alert("通信异常！");
                 }
         });
		 if(returnResult==true){
			 $('#userNameMsg').html('');
		 }
		 return returnResult;
	}
	$('#userNameMsg').html('');
	return true;
}
//邮箱
function userEmailCheck(){
	var userEmail=$.trim($('#userEmail').val());
	if(userEmail==null || userEmail==""){
		$('#userEmailMsg').html('邮箱不能为空！');
		return false;
	}
	var reg =/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(\.[a-zA-Z0-9_-])+/;
	if(!reg.test(userEmail)){
		$('#userEmailMsg').html('邮箱格式不正确！');
		return false;
	}else{
		var returnResult=false;
		 $.ajax({
           url:'/Verification/json/Verification.json',
               type:'post',
               async:false,
               data:{"userEmail":userEmail,"flag":"3"},
               success: function(data){
                   if(data.success){
                  	 returnResult=true;          
                   }else {
                  	 $('#userEmailMsg').html(data.message);
                   }
               },
               error : function(){
                   alert("通信异常！");
               }
       });
		 if(returnResult==true){
			 $('#userEmailMsg').html('');
		 }
		 return returnResult;
	}
	$('#userEmailMsg').html('');
	return true;
}
//密码
function userPwdCheck(){
	var userPwd=$.trim($('#userPwd').val());
	if(userPwd==null || userPwd==""){
		$('#userPwdMsg').html('密码不能为空！');
		return false;
	}else if (userPwd != "" && userPwd.length < 6 || userPwd.length > 16){
		$('#userPwdMsg').html("密码长度为6-16位!");
         return false;
     }
	$('#userPwdMsg').html('');
	return true;
}
//确认密码
function repuserPwdCheck(){
	var userPwd=$.trim($('#userPwd').val());
	var repuserPwd=$.trim($('#repuserPwd').val());
	if(repuserPwd==null || repuserPwd==""){
		$('#repuserPwdMsg').html('确认密码不能为空！');
		return false;
	}
	if(repuserPwd!=userPwd){
		$('#repuserPwdMsg').html('两次输入密码不一致！');
		return false;
	}
	$('#repuserPwdMsg').html('');
	return true;
}

//推荐人手机号
function InvitationPhoneCheck(){
	var InvitationPhone = $.trim($('#InvitationPhone').val());
	if(InvitationPhone.length == 0) {
		$('#InvitationPhoneMsg').html('');
		return true;
	}
// 	var reg = /^1\d{10}$/
// 	if(!reg.test(InvitationPhone)){
// 		$('#InvitationPhoneMsg').html('手机号格式不正确！');
// 		return false;
// 	}
	else{
		var returnResult = false;
		 $.ajax({
            url:'/Verification/json/Verification.json',
                type:'post',
                async:false,
                data:{"userPhone":InvitationPhone,"flag":"2"},
                success: function(data){
                	returnResult = !data.success;
                },
                error : function(){
                    alert("通信异常！");
                }
        });
		$('#InvitationPhoneMsg').html(returnResult?'':'该联系人不是本系统用户');
		return returnResult;
	}
}

//手机号
function userPhoneCheck(){
	var userPhone=$.trim($('#userPhone').val());
	if(userPhone==null || userPhone==""){
		$('#userPhoneMsg').html('手机号不能为空！');
		return false;
	}
	var reg = /^1\d{10}$/
	if(!reg.test(userPhone)){
		$('#userPhoneMsg').html('手机号格式不正确！');
		return false;
	}else{
		var returnResult=false;
		 $.ajax({
            url:'/Verification/json/Verification.json',
                type:'post',
                async:false,
                data:{"userPhone":userPhone,"flag":"2"},
                success: function(data){
                    if(data.success){
                   	 returnResult=true;          
                    }else {
                   	 $('#userPhoneMsg').html(data.message);
                    }
                },
                error : function(){
                    alert("通信异常！");
                }
        });
		 if(returnResult==true){
			 $('#userPhoneMsg').html('');
		 }
		 return returnResult;
	}
	
	$('#userPhoneMsg').html('');
	return true;
}
//验证码
function VerificationCheck(){
	var Verification=$.trim($('#Verification').val());
	if(Verification==null || Verification==""){
		$('#VerificationMsg').html('验证码不能为空！');
		return false;
	}
	$('#VerificationMsg').html('');
	return true;
}
//校验
function check(){
	return (userNameCheck()
			&& userEmailCheck() 
			&& userPwdCheck() 
			&& repuserPwdCheck() 
			&& userPhoneCheck() 
			&& VerificationCheck()
			&& InvitationPhoneCheck());
}
//注册表单提交
function register(){	
	if(check()){
		if($("#agreement").attr("checked")!=undefined){
			$('#register').submit();
		}else{
			alert("请勾选新华久久贷用户协议!");
		}
	}	
}

//发送短息
function sendMsg(){
    var mobile=/^1[3458]\d{9}$/;
    var phone=$.trim($("#userPhone").val());
    var username=$.trim($("#userName").val());
    if(userNameCheck() && userPhoneCheck()){
    	 $("#yanzhengma").removeAttr("onclick");
    	 $("#yanzhengma").removeClass("c-btn").addClass("c-btn-hui");
    	 $("#yanzhengma").html("正在发送...");
    	  $.ajax({
              url:'/register/json/sendPhoneCode.json',
                  type:'post',
                  async:false,
                  data:{"telephone":phone,"username":username},
                  success: function(data){
                      if(data.success){
                    	 $("#yanzhengma").removeAttr("onclick");
                    	 $("#yanzhengma").removeClass("c-btn").addClass("c-btn-hui");
                      	 $("#yanzhengma").html('发送成功');                      	 
                      	 setTimeout('timedCount(60)', 1000);
                      }else {                   	
                      	alert(data.message);
                      	$("#yanzhengma").attr("onclick","sendMsg();");
                      }
                  },
                  error : function(){                	 
                      alert("短信发送失败！");
                      $("#yanzhengma").attr("onclick","sendMsg();");
                  }
          });
    }      
}
//定时器
function timedCount(num){
    if(num==0){
    	$("#yanzhengma").attr("onclick","sendMsg();");
    	 $("#yanzhengma").removeClass("c-btn-hui").addClass("c-btn");
        $("#yanzhengma").html("获取验证码");
        return;
    }
    num = num - 1;
    $("#yanzhengma").html(num);
    setTimeout("timedCount("+num+")",1000); 
}
</script>